---
title:  "Multiple Repository Data Contexts with my Repository Pattern"
date:   2012-01-09
canonical: http://blog.staticvoid.co.nz/2012/1/9/multiple_repository_data_contexts_with_my_repository_pattern
redirect_from:
  - 2012/1/9/multiple_repository_data_contexts_with_my_repository_pattern
---
I recently needed to have links to multiple different database contexts within an application I was developing using StaticVoid.Core.Repository. I use ninject for all of my&nbsp;dependency&nbsp;injection and I though it might be useful to share how I managed to get the repository binding correctly to different versions of DbContext depending on the type requested. Below is a little&nbsp;extension&nbsp;method I wrote to deal with this problem:<br />
<br />
<br />
<div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="color: blue; font-family: Consolas; font-size: 10pt;">public</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">static</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">bool</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;IsInjectingToRepositoryDataSourceOfNamespace(<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; font-family: Consolas; font-size: 10pt;">this</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span style="color: #2b91af; font-family: Consolas; font-size: 10pt;">IRequest</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;request,&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">string</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;entityNamespace)<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">{<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">if</span><span style="font-family: Consolas; font-size: 10pt;">(request.ParentRequest.Service.GetGenericTypeDefinition()&nbsp;==&nbsp;<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: blue; font-family: Consolas; font-size: 10pt;">typeof</span><span style="font-family: Consolas; font-size: 10pt;">(</span><span style="color: #2b91af; font-family: Consolas; font-size: 10pt;">IRepositoryDataSource</span><span style="font-family: Consolas; font-size: 10pt;">&lt;&gt;))<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;{<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">return</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;request.ParentRequest.Service.GetGenericArguments().First().</span><span style="background-color: white; font-family: Consolas; font-size: 10pt;">Namespace&nbsp;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="background-color: white; font-family: Consolas; font-size: 10pt;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;==&nbsp;entityNamespace;</span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;}<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><br />
</div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">return</span><span style="font-family: Consolas; font-size: 10pt;">&nbsp;</span><span style="color: blue; font-family: Consolas; font-size: 10pt;">false</span><span style="font-family: Consolas; font-size: 10pt;">;<o:p></o:p></span></div><div class="MsoNormal" style="background-attachment: initial; background-clip: initial; background-color: white; background-image: initial; background-origin: initial; background-position: initial initial; background-repeat: initial initial; margin-bottom: 0.0001pt;"><span style="font-family: Consolas; font-size: 10pt;">}<o:p></o:p></span></div><div class="MsoNormal"><br />
</div><div class="MsoNormal">This can then be used in the following way:</div><div class="MsoNormal"><br />
</div><div class="MsoNormal"></div><pre style="background: white;"><span style="font-family: Consolas;">Bind&lt;</span><span style="color: #2b91af; font-family: Consolas;">DbContext</span><span style="font-family: Consolas;">&gt;().To&lt;</span><span style="color: #2b91af; font-family: Consolas;">Data1Context</span><span style="font-family: Consolas;">&gt;().When(t&nbsp;=&gt;&nbsp;<o:p></o:p></span></pre><pre style="background: white; margin-left: 36.0pt;"><span style="font-family: Consolas;">t.IsInjectingToRepositoryDataSourceOfNamespace(</span><span style="color: #a31515; font-family: Consolas;">"MyApp.Data1"</span><span style="font-family: Consolas;">));<o:p></o:p></span></pre><pre style="background: white;"><span style="font-family: Consolas;">Bind&lt;</span><span style="color: #2b91af; font-family: Consolas;">DbContext</span><span style="font-family: Consolas;">&gt;().To&lt;</span><span style="color: #2b91af; font-family: Consolas;">Data2Context</span><span style="font-family: Consolas;">&gt;().When(t&nbsp;=&gt;&nbsp;<o:p></o:p></span></pre><pre style="background: white; margin-left: 36.0pt;"><span style="font-family: Consolas;">t.IsInjectingToRepositoryDataSourceOfNamespace(</span><span style="color: #a31515; font-family: Consolas;">"MyApp.Data2"</span><span style="font-family: Consolas;">));</span></pre><pre style="background: white; margin-left: 36.0pt;"><span style="font-family: Consolas;">
</span></pre>This makes it quite tidy to link to multiple data contexts and means that anywhere in your app ninject will infer the data context for that type based on the namespace of the type.
